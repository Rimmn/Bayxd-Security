name: ðŸ”¥ ULTIMATE BOT PROTECTION

on:
  push:
    branches: [main]
    paths:
      - 'database.json'
      - 'index.js'
      - 'handler.js'
      - 'settings.js'
      - 'scurity.js'
      - 'control/**'
      - 'plugins/**'
  pull_request:
    branches: [main]
    paths:
      - 'database.json'
      - 'index.js'
      - 'handler.js'
      - 'settings.js'
      - 'scurity.js'
      - 'control/**'
      - 'plugins/**'

jobs:
  lockdown:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸš¨ ALERT - BOT PROTECTION ACTIVATED
      run: |
        echo "=============================================="
        echo "ðŸ”¥ ULTIMATE BOT PROTECTION SYSTEM ACTIVATED!"
        echo "=============================================="
        echo "Repository: ${{ github.repository }}"
        echo "User making changes: ${{ github.actor }}"
        echo "Event: ${{ github.event_name }}"
        echo "Time: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "=============================================="
    
    - name: ðŸ“¥ CHECKOUT CODE
      uses: actions/checkout@v4
    
    - name: ðŸ‘‘ STRICT OWNER VERIFICATION
      run: |
        echo "=== ðŸ” OWNER VERIFICATION ==="
        
        # HANYA USER INI YANG BOLEH
        ALLOWED_USERS=("Rimmn")
        
        CURRENT_USER="${{ github.actor }}"
        echo "Checking: $CURRENT_USER"
        echo "Allowed: ${ALLOWED_USERS[@]}"
        echo ""
        
        # CEK APAKAH USER DIIZINKAN
        IS_ALLOWED=false
        for user in "${ALLOWED_USERS[@]}"; do
          if [ "$CURRENT_USER" = "$user" ]; then
            IS_ALLOWED=true
            break
          fi
        done
        
        if [ "$IS_ALLOWED" = false ]; then
          echo "âŒâŒâŒ ACCESS DENIED! âŒâŒâŒ"
          echo ""
          echo "========================================"
          echo "ðŸš« UNAUTHORIZED MODIFICATION ATTEMPT!"
          echo "========================================"
          echo "User: $CURRENT_USER"
          echo "Action: Trying to modify critical bot files"
          echo ""
          echo "PROTECTED FILES:"
          echo "- database.json (User database)"
          echo "- index.js (Main bot file)"
          echo "- handler.js (Command handler)"
          echo "- settings.js (Bot configuration)"
          echo "- scurity.js (Security system)"
          echo "- control/ (Core functions)"
          echo "- plugins/ (Bot plugins)"
          echo ""
          echo "âš ï¸  Only these users can modify:"
          echo "    ${ALLOWED_USERS[@]}"
          echo "========================================"
          
          # FAIL THE WORKFLOW
          exit 1
        else
          echo "âœ… VERIFIED! User $CURRENT_USER is authorized"
          echo "Proceeding with changes..."
        fi
    
    - name: ðŸ“‹ VALIDATE FILE CHANGES
      run: |
        echo "=== ðŸ“„ FILE VALIDATION ==="
        
        # Tampilkan file yang diubah
        echo "Modified files in this commit:"
        git diff --name-only HEAD^ HEAD 2>/dev/null || echo "First commit"
        echo ""
    
    - name: âœ… WORKFLOW SUCCESS
      run: |
        echo "========================================"
        echo "ðŸŽ‰ WORKFLOW COMPLETED SUCCESSFULLY!"
        echo "========================================"
        echo "âœ… All security checks passed"
        echo "âœ… User authorization verified"
        echo "âœ… Critical files protected"
        echo ""
        echo "User: ${{ github.actor }}"
        echo "Status: AUTHORIZED"
        echo "Time: $(date '+%H:%M:%S')"
        echo "========================================"
